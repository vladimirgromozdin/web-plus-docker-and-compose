{"ast":null,"code":"var _jsxFileName = \"/Users/vladimirgromozdin/Documents/dev/kupipodariday-frontend/src/components/sign-up/sign-up.jsx\",\n    _s = $RefreshSig$();\n\nimport { useContext, useEffect, useState } from \"react\";\nimport { NavLink, useHistory } from \"react-router-dom\";\nimport { Input, Button, Textarea } from \"../ui\";\nimport { UserContext } from \"../../utils/context\";\nimport { getOwnUser, loginUser, registerUser } from \"../../utils/api\";\nimport { MINIMUM_PASSWORD_LENGTH, MINIMUM_USERNAME_LENGTH, MAXIMUM_DESCRIPTION_LENGTH, EMAIL_REGULAR, URL_REGULAR, MAXIMUM_USERNAME_LENGTH } from \"../../utils/constants\";\nimport styles from \"./sign-up.module.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport const SignUp = _ref => {\n  _s();\n\n  let {\n    extraClass = \"\"\n  } = _ref;\n  const [_user, setUser] = useContext(UserContext);\n  const [userData, setUserData] = useState({\n    username: \"\",\n    email: \"\",\n    password: \"\",\n    about: \"\",\n    avatar: \"\"\n  });\n  const [step, setStep] = useState(1);\n  const [errorMessage, setErrorMessage] = useState(\"\");\n  const [stepOneDisabled, setStepOneDisabled] = useState(true);\n  const [stepTwoDisabled, setStepTwoDisabled] = useState(true);\n  const history = useHistory();\n  useEffect(() => {\n    errorMessage && setErrorMessage(\"\");\n    const usernameValid = userData.username.length >= MINIMUM_USERNAME_LENGTH && userData.username.length <= MAXIMUM_USERNAME_LENGTH;\n    const passwordValid = userData.password.length >= MINIMUM_PASSWORD_LENGTH;\n    const emailValid = EMAIL_REGULAR.test(userData.email);\n    const descriptionValid = userData.about.length < MAXIMUM_DESCRIPTION_LENGTH;\n    const avatarValid = userData.avatar ? URL_REGULAR.test(userData.avatar) : true;\n    setStepOneDisabled(!usernameValid || !passwordValid || !emailValid);\n    setStepTwoDisabled(!descriptionValid || !avatarValid);\n  }, [step, userData]);\n\n  const onChangeInput = e => {\n    const name = e.target.name;\n    const value = e.target.value;\n    setUserData({ ...userData,\n      [name]: value\n    });\n  };\n\n  const handleBackToFirstStep = () => setStep(1);\n\n  const handleSubmit = async () => {\n    if (step === 1) {\n      setStep(2);\n    } else {\n      const {\n        avatar,\n        ...rest\n      } = userData;\n      errorMessage && setErrorMessage(\"\");\n\n      try {\n        if (avatar) {\n          await registerUser(userData);\n        } else {\n          await registerUser(rest);\n        }\n      } catch (err) {\n        setErrorMessage(err.message);\n        return;\n      }\n\n      try {\n        const {\n          access_token\n        } = await loginUser(userData.username, userData.password);\n\n        if (access_token) {\n          const userDto = await getOwnUser();\n          console.log(userDto);\n\n          if (userDto.id) {\n            setUser({ ...userDto\n            });\n            history.replace({\n              pathname: \"/\"\n            });\n          }\n        }\n      } catch (_err) {\n        history.replace({\n          pathname: \"/signin\"\n        });\n      }\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `${styles.content} ${extraClass}`,\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      className: `text text_type_h2 text_color_primary mb-16 ${styles.title}`,\n      children: `Регистрация ${step === 1 ? \"1/2\" : \"2/2\"}`\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      className: styles.form,\n      children: [step === 1 ? /*#__PURE__*/_jsxDEV(StepOne, {\n        onChangeInput: onChangeInput,\n        data: userData\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(StepTwo, {\n        onChangeInput: onChangeInput\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 11\n      }, this), errorMessage && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: styles.error,\n          children: errorMessage\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"button\",\n          className: styles.back_to_first_step,\n          onClick: handleBackToFirstStep,\n          children: \"\\u0412\\u0435\\u0440\\u043D\\u0443\\u0442\\u044C\\u0441\\u044F \\u043D\\u0430 \\u043F\\u0435\\u0440\\u0432\\u044B\\u0439 \\u0448\\u0430\\u0433\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true), /*#__PURE__*/_jsxDEV(Button, {\n        type: \"button\",\n        kind: \"secondary\",\n        text: `${step === 1 ? \"Далее\" : \"Зарегистрироваться\"}`,\n        disabled: step === 1 ? stepOneDisabled : stepTwoDisabled,\n        extraClass: styles.btn,\n        onClick: handleSubmit\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: styles.links_box,\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        className: `text text_type_main text_color_primary mb-9 ${styles.text}`,\n        children: \"\\u0423\\u0436\\u0435 \\u0437\\u0430\\u0440\\u0435\\u0433\\u0438\\u0441\\u0442\\u0440\\u0438\\u0440\\u043E\\u0432\\u0430\\u043D\\u044B?\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(NavLink, {\n        to: \"/signin\",\n        className: `text text_type_button text_color_primary ${styles.nav}`,\n        children: \"\\u0412\\u043E\\u0439\\u0442\\u0438\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 100,\n    columnNumber: 5\n  }, this);\n};\n\n_s(SignUp, \"hlHQZKSFMhlUrnYR4jRHgVNgXYU=\", false, function () {\n  return [useHistory];\n});\n\n_c = SignUp;\n\nconst StepOne = _ref2 => {\n  let {\n    onChangeInput,\n    data\n  } = _ref2;\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Input, {\n      name: \"username\",\n      type: \"username\",\n      id: 1,\n      placeholder: \"\\u041F\\u0440\\u0438\\u0434\\u0443\\u043C\\u0430\\u0439\\u0442\\u0435 \\u044E\\u0437\\u0435\\u0440\\u043D\\u0435\\u0439\\u043C\",\n      label: \"\\u042E\\u0437\\u0435\\u0440\\u043D\\u0435\\u0439\\u043C\",\n      value: data.username,\n      onChange: onChangeInput,\n      extraClass: \"mb-16\",\n      required: true,\n      maxLength: MAXIMUM_USERNAME_LENGTH\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Input, {\n      name: \"email\",\n      type: \"email\",\n      id: 2,\n      placeholder: \"\\u0423\\u043A\\u0430\\u0436\\u0438\\u0442\\u0435 \\u0442\\u0443\\u0442\",\n      label: \"E-mail\",\n      value: data.email,\n      onChange: onChangeInput,\n      extraClass: \"mb-16\",\n      required: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Input, {\n      name: \"password\",\n      type: \"password\",\n      id: 3,\n      placeholder: \"\\u041F\\u0440\\u0438\\u0434\\u0443\\u043C\\u0430\\u0439\\u0442\\u0435 \\u043F\\u0430\\u0440\\u043E\\u043B\\u044C\",\n      label: \"\\u041F\\u0430\\u0440\\u043E\\u043B\\u044C\",\n      value: data.password,\n      onChange: onChangeInput,\n      minLength: MINIMUM_PASSWORD_LENGTH,\n      required: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n\n_c2 = StepOne;\n\nconst StepTwo = _ref3 => {\n  let {\n    onChangeInput\n  } = _ref3;\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Textarea, {\n      name: \"about\",\n      type: \"about\",\n      id: 5,\n      placeholder: \"\\u0420\\u0430\\u0441\\u0441\\u043A\\u0430\\u0436\\u0438\\u0442\\u0435 \\u043E \\u0441\\u0435\\u0431\\u0435\",\n      label: \"\\u041E \\u0441\\u0435\\u0431\\u0435\",\n      onChange: onChangeInput,\n      extraClass: \"mb-16\",\n      maxLength: MAXIMUM_DESCRIPTION_LENGTH\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Input, {\n      name: \"avatar\",\n      type: \"url\",\n      id: 7,\n      placeholder: \"\\u0423\\u043A\\u0430\\u0436\\u0438\\u0442\\u0435 \\u0442\\u0443\\u0442 \\u0441\\u0441\\u044B\\u043B\\u043A\\u0443 \\u043D\\u0430 \\u0430\\u0432\\u0430\\u0442\\u0430\\u0440\",\n      label: \"\\u0410\\u0432\\u0430\\u0442\\u0430\\u0440\",\n      onChange: onChangeInput,\n      extraClass: \"mb-16\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n\n_c3 = StepTwo;\n\nvar _c, _c2, _c3;\n\n$RefreshReg$(_c, \"SignUp\");\n$RefreshReg$(_c2, \"StepOne\");\n$RefreshReg$(_c3, \"StepTwo\");","map":{"version":3,"sources":["/Users/vladimirgromozdin/Documents/dev/kupipodariday-frontend/src/components/sign-up/sign-up.jsx"],"names":["useContext","useEffect","useState","NavLink","useHistory","Input","Button","Textarea","UserContext","getOwnUser","loginUser","registerUser","MINIMUM_PASSWORD_LENGTH","MINIMUM_USERNAME_LENGTH","MAXIMUM_DESCRIPTION_LENGTH","EMAIL_REGULAR","URL_REGULAR","MAXIMUM_USERNAME_LENGTH","styles","SignUp","extraClass","_user","setUser","userData","setUserData","username","email","password","about","avatar","step","setStep","errorMessage","setErrorMessage","stepOneDisabled","setStepOneDisabled","stepTwoDisabled","setStepTwoDisabled","history","usernameValid","length","passwordValid","emailValid","test","descriptionValid","avatarValid","onChangeInput","e","name","target","value","handleBackToFirstStep","handleSubmit","rest","err","message","access_token","userDto","console","log","id","replace","pathname","_err","content","title","form","error","back_to_first_step","btn","links_box","text","nav","StepOne","data","StepTwo"],"mappings":";;;AAAA,SAASA,UAAT,EAAqBC,SAArB,EAAgCC,QAAhC,QAAgD,OAAhD;AACA,SAASC,OAAT,EAAkBC,UAAlB,QAAoC,kBAApC;AAEA,SAASC,KAAT,EAAgBC,MAAhB,EAAwBC,QAAxB,QAAwC,OAAxC;AAEA,SAASC,WAAT,QAA4B,qBAA5B;AACA,SAASC,UAAT,EAAqBC,SAArB,EAAgCC,YAAhC,QAAoD,iBAApD;AAEA,SACEC,uBADF,EAEEC,uBAFF,EAGEC,0BAHF,EAIEC,aAJF,EAKEC,WALF,EAMEC,uBANF,QAOO,uBAPP;AASA,OAAOC,MAAP,MAAmB,sBAAnB;;;AAEA,OAAO,MAAMC,MAAM,GAAG,QAAyB;AAAA;;AAAA,MAAxB;AAAEC,IAAAA,UAAU,GAAG;AAAf,GAAwB;AAC7C,QAAM,CAACC,KAAD,EAAQC,OAAR,IAAmBtB,UAAU,CAACQ,WAAD,CAAnC;AACA,QAAM,CAACe,QAAD,EAAWC,WAAX,IAA0BtB,QAAQ,CAAC;AACvCuB,IAAAA,QAAQ,EAAE,EAD6B;AAEvCC,IAAAA,KAAK,EAAE,EAFgC;AAGvCC,IAAAA,QAAQ,EAAE,EAH6B;AAIvCC,IAAAA,KAAK,EAAE,EAJgC;AAKvCC,IAAAA,MAAM,EAAE;AAL+B,GAAD,CAAxC;AAOA,QAAM,CAACC,IAAD,EAAOC,OAAP,IAAkB7B,QAAQ,CAAC,CAAD,CAAhC;AACA,QAAM,CAAC8B,YAAD,EAAeC,eAAf,IAAkC/B,QAAQ,CAAC,EAAD,CAAhD;AACA,QAAM,CAACgC,eAAD,EAAkBC,kBAAlB,IAAwCjC,QAAQ,CAAC,IAAD,CAAtD;AACA,QAAM,CAACkC,eAAD,EAAkBC,kBAAlB,IAAwCnC,QAAQ,CAAC,IAAD,CAAtD;AACA,QAAMoC,OAAO,GAAGlC,UAAU,EAA1B;AAEAH,EAAAA,SAAS,CAAC,MAAM;AACd+B,IAAAA,YAAY,IAAIC,eAAe,CAAC,EAAD,CAA/B;AACA,UAAMM,aAAa,GACjBhB,QAAQ,CAACE,QAAT,CAAkBe,MAAlB,IAA4B3B,uBAA5B,IACAU,QAAQ,CAACE,QAAT,CAAkBe,MAAlB,IAA4BvB,uBAF9B;AAGA,UAAMwB,aAAa,GAAGlB,QAAQ,CAACI,QAAT,CAAkBa,MAAlB,IAA4B5B,uBAAlD;AACA,UAAM8B,UAAU,GAAG3B,aAAa,CAAC4B,IAAd,CAAmBpB,QAAQ,CAACG,KAA5B,CAAnB;AACA,UAAMkB,gBAAgB,GAAGrB,QAAQ,CAACK,KAAT,CAAeY,MAAf,GAAwB1B,0BAAjD;AACA,UAAM+B,WAAW,GAAGtB,QAAQ,CAACM,MAAT,GAChBb,WAAW,CAAC2B,IAAZ,CAAiBpB,QAAQ,CAACM,MAA1B,CADgB,GAEhB,IAFJ;AAIAM,IAAAA,kBAAkB,CAAC,CAACI,aAAD,IAAkB,CAACE,aAAnB,IAAoC,CAACC,UAAtC,CAAlB;AACAL,IAAAA,kBAAkB,CAAC,CAACO,gBAAD,IAAqB,CAACC,WAAvB,CAAlB;AACD,GAdQ,EAcN,CAACf,IAAD,EAAOP,QAAP,CAdM,CAAT;;AAgBA,QAAMuB,aAAa,GAAIC,CAAD,IAAO;AAC3B,UAAMC,IAAI,GAAGD,CAAC,CAACE,MAAF,CAASD,IAAtB;AACA,UAAME,KAAK,GAAGH,CAAC,CAACE,MAAF,CAASC,KAAvB;AACA1B,IAAAA,WAAW,CAAC,EACV,GAAGD,QADO;AAEV,OAACyB,IAAD,GAAQE;AAFE,KAAD,CAAX;AAID,GAPD;;AASA,QAAMC,qBAAqB,GAAG,MAAMpB,OAAO,CAAC,CAAD,CAA3C;;AAEA,QAAMqB,YAAY,GAAG,YAAY;AAC/B,QAAItB,IAAI,KAAK,CAAb,EAAgB;AACdC,MAAAA,OAAO,CAAC,CAAD,CAAP;AACD,KAFD,MAEO;AACL,YAAM;AAAEF,QAAAA,MAAF;AAAU,WAAGwB;AAAb,UAAsB9B,QAA5B;AACAS,MAAAA,YAAY,IAAIC,eAAe,CAAC,EAAD,CAA/B;;AACA,UAAI;AACF,YAAIJ,MAAJ,EAAY;AACV,gBAAMlB,YAAY,CAACY,QAAD,CAAlB;AACD,SAFD,MAEO;AACL,gBAAMZ,YAAY,CAAC0C,IAAD,CAAlB;AACD;AACF,OAND,CAME,OAAOC,GAAP,EAAY;AACZrB,QAAAA,eAAe,CAACqB,GAAG,CAACC,OAAL,CAAf;AACA;AACD;;AAED,UAAI;AACF,cAAM;AAAEC,UAAAA;AAAF,YAAmB,MAAM9C,SAAS,CACtCa,QAAQ,CAACE,QAD6B,EAEtCF,QAAQ,CAACI,QAF6B,CAAxC;;AAIA,YAAI6B,YAAJ,EAAkB;AAChB,gBAAMC,OAAO,GAAG,MAAMhD,UAAU,EAAhC;AACAiD,UAAAA,OAAO,CAACC,GAAR,CAAYF,OAAZ;;AAEA,cAAIA,OAAO,CAACG,EAAZ,EAAgB;AACdtC,YAAAA,OAAO,CAAC,EAAE,GAAGmC;AAAL,aAAD,CAAP;AACAnB,YAAAA,OAAO,CAACuB,OAAR,CAAgB;AAAEC,cAAAA,QAAQ,EAAE;AAAZ,aAAhB;AACD;AACF;AACF,OAdD,CAcE,OAAOC,IAAP,EAAa;AACbzB,QAAAA,OAAO,CAACuB,OAAR,CAAgB;AAAEC,UAAAA,QAAQ,EAAE;AAAZ,SAAhB;AACD;AACF;AACF,GAnCD;;AAqCA,sBACE;AAAK,IAAA,SAAS,EAAG,GAAE5C,MAAM,CAAC8C,OAAQ,IAAG5C,UAAW,EAAhD;AAAA,4BACE;AACE,MAAA,SAAS,EAAG,8CAA6CF,MAAM,CAAC+C,KAAM,EADxE;AAAA,gBAGI,eAAcnC,IAAI,KAAK,CAAT,GAAa,KAAb,GAAqB,KAAM;AAH7C;AAAA;AAAA;AAAA;AAAA,YADF,eAME;AAAM,MAAA,SAAS,EAAEZ,MAAM,CAACgD,IAAxB;AAAA,iBACGpC,IAAI,KAAK,CAAT,gBACC,QAAC,OAAD;AAAS,QAAA,aAAa,EAAEgB,aAAxB;AAAuC,QAAA,IAAI,EAAEvB;AAA7C;AAAA;AAAA;AAAA;AAAA,cADD,gBAGC,QAAC,OAAD;AAAS,QAAA,aAAa,EAAEuB;AAAxB;AAAA;AAAA;AAAA;AAAA,cAJJ,EAMGd,YAAY,iBACX;AAAA,gCACE;AAAM,UAAA,SAAS,EAAEd,MAAM,CAACiD,KAAxB;AAAA,oBAAgCnC;AAAhC;AAAA;AAAA;AAAA;AAAA,gBADF,eAEE;AACE,UAAA,IAAI,EAAC,QADP;AAEE,UAAA,SAAS,EAAEd,MAAM,CAACkD,kBAFpB;AAGE,UAAA,OAAO,EAAEjB,qBAHX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAFF;AAAA,sBAPJ,eAkBE,QAAC,MAAD;AACE,QAAA,IAAI,EAAC,QADP;AAEE,QAAA,IAAI,EAAC,WAFP;AAGE,QAAA,IAAI,EAAG,GAAErB,IAAI,KAAK,CAAT,GAAa,OAAb,GAAuB,oBAAqB,EAHvD;AAIE,QAAA,QAAQ,EAAEA,IAAI,KAAK,CAAT,GAAaI,eAAb,GAA+BE,eAJ3C;AAKE,QAAA,UAAU,EAAElB,MAAM,CAACmD,GALrB;AAME,QAAA,OAAO,EAAEjB;AANX;AAAA;AAAA;AAAA;AAAA,cAlBF;AAAA;AAAA;AAAA;AAAA;AAAA,YANF,eAiCE;AAAK,MAAA,SAAS,EAAElC,MAAM,CAACoD,SAAvB;AAAA,8BACE;AACE,QAAA,SAAS,EAAG,+CAA8CpD,MAAM,CAACqD,IAAK,EADxE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cADF,eAME,QAAC,OAAD;AACE,QAAA,EAAE,EAAC,SADL;AAEE,QAAA,SAAS,EAAG,4CAA2CrD,MAAM,CAACsD,GAAI,EAFpE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cANF;AAAA;AAAA;AAAA;AAAA;AAAA,YAjCF;AAAA;AAAA;AAAA;AAAA;AAAA,UADF;AAiDD,CAhIM;;GAAMrD,M;UAaKf,U;;;KAbLe,M;;AAkIb,MAAMsD,OAAO,GAAG,SAA6B;AAAA,MAA5B;AAAE3B,IAAAA,aAAF;AAAiB4B,IAAAA;AAAjB,GAA4B;AAC3C,sBACE;AAAA,4BACE,QAAC,KAAD;AACE,MAAA,IAAI,EAAC,UADP;AAEE,MAAA,IAAI,EAAC,UAFP;AAGE,MAAA,EAAE,EAAE,CAHN;AAIE,MAAA,WAAW,EAAC,+GAJd;AAKE,MAAA,KAAK,EAAC,kDALR;AAME,MAAA,KAAK,EAAEA,IAAI,CAACjD,QANd;AAOE,MAAA,QAAQ,EAAEqB,aAPZ;AAQE,MAAA,UAAU,EAAC,OARb;AASE,MAAA,QAAQ,EAAE,IATZ;AAUE,MAAA,SAAS,EAAE7B;AAVb;AAAA;AAAA;AAAA;AAAA,YADF,eAaE,QAAC,KAAD;AACE,MAAA,IAAI,EAAC,OADP;AAEE,MAAA,IAAI,EAAC,OAFP;AAGE,MAAA,EAAE,EAAE,CAHN;AAIE,MAAA,WAAW,EAAC,+DAJd;AAKE,MAAA,KAAK,EAAC,QALR;AAME,MAAA,KAAK,EAAEyD,IAAI,CAAChD,KANd;AAOE,MAAA,QAAQ,EAAEoB,aAPZ;AAQE,MAAA,UAAU,EAAC,OARb;AASE,MAAA,QAAQ,EAAE;AATZ;AAAA;AAAA;AAAA;AAAA,YAbF,eAwBE,QAAC,KAAD;AACE,MAAA,IAAI,EAAC,UADP;AAEE,MAAA,IAAI,EAAC,UAFP;AAGE,MAAA,EAAE,EAAE,CAHN;AAIE,MAAA,WAAW,EAAC,mGAJd;AAKE,MAAA,KAAK,EAAC,sCALR;AAME,MAAA,KAAK,EAAE4B,IAAI,CAAC/C,QANd;AAOE,MAAA,QAAQ,EAAEmB,aAPZ;AAQE,MAAA,SAAS,EAAElC,uBARb;AASE,MAAA,QAAQ,EAAE;AATZ;AAAA;AAAA;AAAA;AAAA,YAxBF;AAAA,kBADF;AAsCD,CAvCD;;MAAM6D,O;;AAyCN,MAAME,OAAO,GAAG,SAAuB;AAAA,MAAtB;AAAE7B,IAAAA;AAAF,GAAsB;AACrC,sBACE;AAAA,4BACE,QAAC,QAAD;AACE,MAAA,IAAI,EAAC,OADP;AAEE,MAAA,IAAI,EAAC,OAFP;AAGE,MAAA,EAAE,EAAE,CAHN;AAIE,MAAA,WAAW,EAAC,8FAJd;AAKE,MAAA,KAAK,EAAC,iCALR;AAME,MAAA,QAAQ,EAAEA,aANZ;AAOE,MAAA,UAAU,EAAC,OAPb;AAQE,MAAA,SAAS,EAAEhC;AARb;AAAA;AAAA;AAAA;AAAA,YADF,eAWE,QAAC,KAAD;AACE,MAAA,IAAI,EAAC,QADP;AAEE,MAAA,IAAI,EAAC,KAFP;AAGE,MAAA,EAAE,EAAE,CAHN;AAIE,MAAA,WAAW,EAAC,sJAJd;AAKE,MAAA,KAAK,EAAC,sCALR;AAME,MAAA,QAAQ,EAAEgC,aANZ;AAOE,MAAA,UAAU,EAAC;AAPb;AAAA;AAAA;AAAA;AAAA,YAXF;AAAA,kBADF;AAuBD,CAxBD;;MAAM6B,O","sourcesContent":["import { useContext, useEffect, useState } from \"react\";\nimport { NavLink, useHistory } from \"react-router-dom\";\n\nimport { Input, Button, Textarea } from \"../ui\";\n\nimport { UserContext } from \"../../utils/context\";\nimport { getOwnUser, loginUser, registerUser } from \"../../utils/api\";\n\nimport {\n  MINIMUM_PASSWORD_LENGTH,\n  MINIMUM_USERNAME_LENGTH,\n  MAXIMUM_DESCRIPTION_LENGTH,\n  EMAIL_REGULAR,\n  URL_REGULAR,\n  MAXIMUM_USERNAME_LENGTH,\n} from \"../../utils/constants\";\n\nimport styles from \"./sign-up.module.css\";\n\nexport const SignUp = ({ extraClass = \"\" }) => {\n  const [_user, setUser] = useContext(UserContext);\n  const [userData, setUserData] = useState({\n    username: \"\",\n    email: \"\",\n    password: \"\",\n    about: \"\",\n    avatar: \"\",\n  });\n  const [step, setStep] = useState(1);\n  const [errorMessage, setErrorMessage] = useState(\"\");\n  const [stepOneDisabled, setStepOneDisabled] = useState(true);\n  const [stepTwoDisabled, setStepTwoDisabled] = useState(true);\n  const history = useHistory();\n\n  useEffect(() => {\n    errorMessage && setErrorMessage(\"\");\n    const usernameValid =\n      userData.username.length >= MINIMUM_USERNAME_LENGTH &&\n      userData.username.length <= MAXIMUM_USERNAME_LENGTH;\n    const passwordValid = userData.password.length >= MINIMUM_PASSWORD_LENGTH;\n    const emailValid = EMAIL_REGULAR.test(userData.email);\n    const descriptionValid = userData.about.length < MAXIMUM_DESCRIPTION_LENGTH;\n    const avatarValid = userData.avatar\n      ? URL_REGULAR.test(userData.avatar)\n      : true;\n\n    setStepOneDisabled(!usernameValid || !passwordValid || !emailValid);\n    setStepTwoDisabled(!descriptionValid || !avatarValid);\n  }, [step, userData]);\n\n  const onChangeInput = (e) => {\n    const name = e.target.name;\n    const value = e.target.value;\n    setUserData({\n      ...userData,\n      [name]: value,\n    });\n  };\n\n  const handleBackToFirstStep = () => setStep(1);\n\n  const handleSubmit = async () => {\n    if (step === 1) {\n      setStep(2);\n    } else {\n      const { avatar, ...rest } = userData;\n      errorMessage && setErrorMessage(\"\");\n      try {\n        if (avatar) {\n          await registerUser(userData);\n        } else {\n          await registerUser(rest);\n        }\n      } catch (err) {\n        setErrorMessage(err.message);\n        return;\n      }\n\n      try {\n        const { access_token } = await loginUser(\n          userData.username,\n          userData.password\n        );\n        if (access_token) {\n          const userDto = await getOwnUser();\n          console.log(userDto);\n\n          if (userDto.id) {\n            setUser({ ...userDto });\n            history.replace({ pathname: \"/\" });\n          }\n        }\n      } catch (_err) {\n        history.replace({ pathname: \"/signin\" });\n      }\n    }\n  };\n\n  return (\n    <div className={`${styles.content} ${extraClass}`}>\n      <h2\n        className={`text text_type_h2 text_color_primary mb-16 ${styles.title}`}\n      >\n        {`Регистрация ${step === 1 ? \"1/2\" : \"2/2\"}`}\n      </h2>\n      <form className={styles.form}>\n        {step === 1 ? (\n          <StepOne onChangeInput={onChangeInput} data={userData} />\n        ) : (\n          <StepTwo onChangeInput={onChangeInput} />\n        )}\n        {errorMessage && (\n          <>\n            <span className={styles.error}>{errorMessage}</span>\n            <button\n              type=\"button\"\n              className={styles.back_to_first_step}\n              onClick={handleBackToFirstStep}\n            >\n              Вернуться на первый шаг\n            </button>\n          </>\n        )}\n        <Button\n          type=\"button\"\n          kind=\"secondary\"\n          text={`${step === 1 ? \"Далее\" : \"Зарегистрироваться\"}`}\n          disabled={step === 1 ? stepOneDisabled : stepTwoDisabled}\n          extraClass={styles.btn}\n          onClick={handleSubmit}\n        />\n      </form>\n      <div className={styles.links_box}>\n        <p\n          className={`text text_type_main text_color_primary mb-9 ${styles.text}`}\n        >\n          Уже зарегистрированы?\n        </p>\n        <NavLink\n          to=\"/signin\"\n          className={`text text_type_button text_color_primary ${styles.nav}`}\n        >\n          Войти\n        </NavLink>\n      </div>\n    </div>\n  );\n};\n\nconst StepOne = ({ onChangeInput, data }) => {\n  return (\n    <>\n      <Input\n        name=\"username\"\n        type=\"username\"\n        id={1}\n        placeholder=\"Придумайте юзернейм\"\n        label=\"Юзернейм\"\n        value={data.username}\n        onChange={onChangeInput}\n        extraClass=\"mb-16\"\n        required={true}\n        maxLength={MAXIMUM_USERNAME_LENGTH}\n      />\n      <Input\n        name=\"email\"\n        type=\"email\"\n        id={2}\n        placeholder=\"Укажите тут\"\n        label=\"E-mail\"\n        value={data.email}\n        onChange={onChangeInput}\n        extraClass=\"mb-16\"\n        required={true}\n      />\n      <Input\n        name=\"password\"\n        type=\"password\"\n        id={3}\n        placeholder=\"Придумайте пароль\"\n        label=\"Пароль\"\n        value={data.password}\n        onChange={onChangeInput}\n        minLength={MINIMUM_PASSWORD_LENGTH}\n        required={true}\n      />\n    </>\n  );\n};\n\nconst StepTwo = ({ onChangeInput }) => {\n  return (\n    <>\n      <Textarea\n        name=\"about\"\n        type=\"about\"\n        id={5}\n        placeholder=\"Расскажите о себе\"\n        label=\"О себе\"\n        onChange={onChangeInput}\n        extraClass=\"mb-16\"\n        maxLength={MAXIMUM_DESCRIPTION_LENGTH}\n      />\n      <Input\n        name=\"avatar\"\n        type=\"url\"\n        id={7}\n        placeholder=\"Укажите тут ссылку на аватар\"\n        label=\"Аватар\"\n        onChange={onChangeInput}\n        extraClass=\"mb-16\"\n      />\n    </>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}