{"ast":null,"code":"import _defineProperty from\"/Users/vladimirgromozdin/Documents/dev/deploy-kupipodariday/frontend/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"/Users/vladimirgromozdin/Documents/dev/deploy-kupipodariday/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"/Users/vladimirgromozdin/Documents/dev/deploy-kupipodariday/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/Users/vladimirgromozdin/Documents/dev/deploy-kupipodariday/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect,useRef,useContext}from\"react\";import{NavLink}from\"react-router-dom\";import{Button,Input,Modal}from\"../ui\";import trashIcon from\"../../images/icons/trash-red.svg\";import{UserContext}from\"../../utils/context\";import{addCollection,deleteCollection,getCollections}from\"../../utils/api\";import styles from\"./main-page.module.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var CollectionsView=function CollectionsView(_ref){var url=_ref.url,ownWishes=_ref.ownWishes;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isCollectionPopupOpen=_useState2[0],setIsCollectionPopupOpen=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isRemovePopupOpen=_useState4[0],setIsRemovePopupOpen=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),idToRemove=_useState6[0],setIdToRemove=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),collectionsList=_useState8[0],setCollectionsList=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),errorRemoveMessage=_useState10[0],setErrorRemoveMessage=_useState10[1];var _useContext=useContext(UserContext),_useContext2=_slicedToArray(_useContext,1),user=_useContext2[0];useEffect(function(){getCollections().then(function(res){return setCollectionsList(res);});},[]);var handleCollectionPopupOpen=function handleCollectionPopupOpen(){setIsCollectionPopupOpen(true);};var handlePopupClose=function handlePopupClose(){isCollectionPopupOpen&&setIsCollectionPopupOpen(false);isRemovePopupOpen&&setIsRemovePopupOpen(false);errorRemoveMessage&&setErrorRemoveMessage(\"\");};var handleRemoveClick=function handleRemoveClick(e){e.preventDefault();setIdToRemove(e.target.closest(\"a\").name);setIsRemovePopupOpen(true);};var handleRemoveCollection=function handleRemoveCollection(){deleteCollection(idToRemove).then(function(){getCollections().then(function(res){setCollectionsList(res);handlePopupClose();});}).catch(function(err){return setErrorRemoveMessage(err.message);});};return/*#__PURE__*/_jsxs(\"section\",{className:styles.collections,children:[/*#__PURE__*/_jsx(Button,{kind:\"primary\",text:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u043A\\u043E\\u043B\\u043B\\u0435\\u043A\\u0446\\u0438\\u044E\",onClick:handleCollectionPopupOpen}),/*#__PURE__*/_jsx(\"div\",{className:styles.cards_box,children:collectionsList.map(function(card){var _card$owner;return/*#__PURE__*/_jsxs(NavLink,{className:styles.card,name:card.id,to:\"\".concat(url,\"/collections/\").concat(card.id),style:{backgroundImage:\"url(\".concat(card.image,\")\")},children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text text_type_cardh3 text_color_secondary \".concat(styles.text),children:card.name}),user.id===((_card$owner=card.owner)===null||_card$owner===void 0?void 0:_card$owner.id)&&/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:styles.remove_btn,onClick:handleRemoveClick,children:/*#__PURE__*/_jsx(\"img\",{src:trashIcon,alt:\"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C.\"})})]},card.id);})}),isCollectionPopupOpen&&/*#__PURE__*/_jsx(CollectionAddModal,{ownWishes:ownWishes,onClose:handlePopupClose,collectionsList:collectionsList,setCollectionsList:setCollectionsList}),isRemovePopupOpen&&/*#__PURE__*/_jsx(Modal,{onClose:handlePopupClose,extraClass:styles.modal,children:/*#__PURE__*/_jsxs(\"div\",{className:styles.popup,children:[/*#__PURE__*/_jsx(\"p\",{className:\"text text_type_main mb-10\",children:\"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C \\u043A\\u043E\\u043B\\u043B\\u0435\\u043A\\u0446\\u0438\\u044E?\"}),errorRemoveMessage&&/*#__PURE__*/_jsx(\"span\",{className:styles.error,children:errorRemoveMessage}),/*#__PURE__*/_jsxs(\"div\",{className:styles.popup_btn_box,children:[/*#__PURE__*/_jsx(Button,{type:\"button\",extraClass:styles.popup_btn,kind:\"support\",text:\"\\u041E\\u0442\\u043C\\u0435\\u043D\\u0430\",onClick:handlePopupClose}),/*#__PURE__*/_jsx(Button,{type:\"button\",extraClass:styles.popup_btn,kind:\"secondary\",onClick:handleRemoveCollection,text:\"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C\"})]})]})})]});};var CollectionAddModal=function CollectionAddModal(_ref2){var ownWishes=_ref2.ownWishes,onClose=_ref2.onClose,collectionsList=_ref2.collectionsList,setCollectionsList=_ref2.setCollectionsList;var _useState11=useState({wishes:{}}),_useState12=_slicedToArray(_useState11,2),collectionData=_useState12[0],setCollectionData=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),valid=_useState14[0],setValid=_useState14[1];var _useState15=useState(\"\"),_useState16=_slicedToArray(_useState15,2),errorMessage=_useState16[0],setErrorMessage=_useState16[1];var formRef=useRef(null);var submitCollection=function submitCollection(e){e.preventDefault();errorMessage&&setErrorMessage(\"\");var name=collectionData.name,image=collectionData.image;var itemsId=Object.entries(collectionData.wishes).map(function(_ref3){var _ref4=_slicedToArray(_ref3,2),key=_ref4[0],val=_ref4[1];if(val){return+key;}});addCollection({name:name,image:image,itemsId:itemsId}).then(function(res){var name=res.name,image=res.image,id=res.id,owner=res.owner;setCollectionsList([].concat(_toConsumableArray(collectionsList),[{name:name,image:image,id:id,owner:owner}]));onClose();}).catch(function(err){setErrorMessage(err.message);});};var onFormChange=function onFormChange(e){var isValid=formRef.current.checkValidity();setValid(isValid);var name=e.target.name;var value=e.target.value;if(name.startsWith(\"wish\")){var _name$split=name.split(\" \"),_name$split2=_slicedToArray(_name$split,2),key=_name$split2[1];setCollectionData(_objectSpread(_objectSpread({},collectionData),{},{wishes:_objectSpread(_objectSpread({},collectionData.wishes),{},_defineProperty({},key,e.target.checked))}));}else{setCollectionData(_objectSpread(_objectSpread({},collectionData),{},_defineProperty({},name,name===\"price\"?parseInt(value):value)));}};return/*#__PURE__*/_jsx(Modal,{onClose:onClose,extraClass:styles.collection_modal,isCloseBtn:true,children:/*#__PURE__*/_jsxs(\"form\",{className:styles.collection_form,onSubmit:submitCollection,ref:formRef,children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text text_type_h2 mb-16\",children:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u043F\\u043E\\u0434\\u0430\\u0440\\u043E\\u043A\"}),/*#__PURE__*/_jsx(Input,{type:\"text\",id:20,extraClass:\"mb-12\",label:\"\\u041D\\u0430\\u0437\\u0432\\u0430\\u043D\\u0438\\u0435 \\u043A\\u043E\\u043B\\u043B\\u0435\\u043A\\u0446\\u0438\\u0438\",name:\"name\",onChange:onFormChange,placeholder:\"\\u0423\\u043A\\u0430\\u0436\\u0438\\u0442\\u0435 \\u043D\\u0430\\u0437\\u0432\\u0430\\u043D\\u0438\\u0435 \\u043A\\u043E\\u043B\\u043B\\u0435\\u043A\\u0446\\u0438\\u0438\",required:true}),/*#__PURE__*/_jsx(Input,{type:\"url\",extraClass:\"mb-12\",name:\"image\",label:\"\\u0421\\u0441\\u044B\\u043B\\u043A\\u0430 \\u043D\\u0430 \\u0438\\u0437\\u043E\\u0431\\u0440\\u0430\\u0436\\u0435\\u043D\\u0438\\u0435\",onChange:onFormChange,placeholder:\"\\u0423\\u043A\\u0430\\u0436\\u0438\\u0442\\u0435 \\u0441\\u0441\\u044B\\u043B\\u043A\\u0443\",required:true}),/*#__PURE__*/_jsx(\"p\",{className:\"text text_type_main text_color_black mb-4 \".concat(styles.wishes_text),children:\"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u0442\\u043E\\u0432\\u0430\\u0440\\u044B \\u0438\\u0437 \\u0432\\u0430\\u0448\\u0435\\u0433\\u043E \\u0432\\u0438\\u0448\\u043B\\u0438\\u0441\\u0442\\u0430:\"}),/*#__PURE__*/_jsx(\"div\",{className:styles.wishes,children:ownWishes.map(function(item){var _collectionData$wishe;return/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"input\",{className:styles.checkbox,type:\"checkbox\",id:item.id,name:\"wish \".concat(item.id),checked:(_collectionData$wishe=collectionData.wishes[item.id])!==null&&_collectionData$wishe!==void 0?_collectionData$wishe:false,onChange:onFormChange}),/*#__PURE__*/_jsx(\"label\",{className:styles.checkbox,htmlFor:item.id,children:item.name})]},item.id);})}),errorMessage&&/*#__PURE__*/_jsx(\"span\",{className:styles.error,children:errorMessage}),/*#__PURE__*/_jsx(Button,{type:\"submit\",extraClass:styles.collection_btn,text:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u043A\\u043E\\u043B\\u043B\\u0435\\u043A\\u0446\\u0438\\u044E\",kind:\"secondary\",disabled:!valid})]})});};","map":{"version":3,"sources":["/Users/vladimirgromozdin/Documents/dev/deploy-kupipodariday/frontend/src/components/main-page/collections-view.jsx"],"names":["useState","useEffect","useRef","useContext","NavLink","Button","Input","Modal","trashIcon","UserContext","addCollection","deleteCollection","getCollections","styles","CollectionsView","url","ownWishes","isCollectionPopupOpen","setIsCollectionPopupOpen","isRemovePopupOpen","setIsRemovePopupOpen","idToRemove","setIdToRemove","collectionsList","setCollectionsList","errorRemoveMessage","setErrorRemoveMessage","user","then","res","handleCollectionPopupOpen","handlePopupClose","handleRemoveClick","e","preventDefault","target","closest","name","handleRemoveCollection","catch","err","message","collections","cards_box","map","card","id","backgroundImage","image","text","owner","remove_btn","modal","popup","error","popup_btn_box","popup_btn","CollectionAddModal","onClose","wishes","collectionData","setCollectionData","valid","setValid","errorMessage","setErrorMessage","formRef","submitCollection","itemsId","Object","entries","key","val","onFormChange","isValid","current","checkValidity","value","startsWith","split","checked","parseInt","collection_modal","collection_form","wishes_text","item","checkbox","collection_btn"],"mappings":"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","sourcesContent":["import { useState, useEffect, useRef, useContext } from \"react\";\nimport { NavLink } from \"react-router-dom\";\n\nimport { Button, Input, Modal } from \"../ui\";\n\nimport trashIcon from \"../../images/icons/trash-red.svg\";\n\nimport { UserContext } from \"../../utils/context\";\n\nimport {\n  addCollection,\n  deleteCollection,\n  getCollections,\n} from \"../../utils/api\";\n\nimport styles from \"./main-page.module.css\";\n\nexport const CollectionsView = ({ url, ownWishes }) => {\n  const [isCollectionPopupOpen, setIsCollectionPopupOpen] = useState(false);\n  const [isRemovePopupOpen, setIsRemovePopupOpen] = useState(false);\n  const [idToRemove, setIdToRemove] = useState(\"\");\n  const [collectionsList, setCollectionsList] = useState([]);\n  const [errorRemoveMessage, setErrorRemoveMessage] = useState(\"\");\n\n  const [user] = useContext(UserContext);\n\n  useEffect(() => {\n    getCollections().then((res) => setCollectionsList(res));\n  }, []);\n\n  const handleCollectionPopupOpen = () => {\n    setIsCollectionPopupOpen(true);\n  };\n\n  const handlePopupClose = () => {\n    isCollectionPopupOpen && setIsCollectionPopupOpen(false);\n    isRemovePopupOpen && setIsRemovePopupOpen(false);\n    errorRemoveMessage && setErrorRemoveMessage(\"\");\n  };\n\n  const handleRemoveClick = (e) => {\n    e.preventDefault();\n    setIdToRemove(e.target.closest(\"a\").name);\n    setIsRemovePopupOpen(true);\n  };\n\n  const handleRemoveCollection = () => {\n    deleteCollection(idToRemove)\n      .then(() => {\n        getCollections().then((res) => {\n          setCollectionsList(res);\n          handlePopupClose();\n        });\n      })\n      .catch((err) => setErrorRemoveMessage(err.message));\n  };\n\n  return (\n    <section className={styles.collections}>\n      <Button\n        kind=\"primary\"\n        text=\"Добавить коллекцию\"\n        onClick={handleCollectionPopupOpen}\n      />\n      <div className={styles.cards_box}>\n        {collectionsList.map((card) => {\n          return (\n            <NavLink\n              key={card.id}\n              className={styles.card}\n              name={card.id}\n              to={`${url}/collections/${card.id}`}\n              style={{\n                backgroundImage: `url(${card.image})`,\n              }}\n            >\n              <h3\n                className={`text text_type_cardh3 text_color_secondary ${styles.text}`}\n              >\n                {card.name}\n              </h3>\n              {user.id === card.owner?.id && (\n                <button\n                  type=\"button\"\n                  className={styles.remove_btn}\n                  onClick={handleRemoveClick}\n                >\n                  <img src={trashIcon} alt=\"Удалить.\" />\n                </button>\n              )}\n            </NavLink>\n          );\n        })}\n      </div>\n      {isCollectionPopupOpen && (\n        <CollectionAddModal\n          ownWishes={ownWishes}\n          onClose={handlePopupClose}\n          collectionsList={collectionsList}\n          setCollectionsList={setCollectionsList}\n        />\n      )}\n      {isRemovePopupOpen && (\n        <Modal onClose={handlePopupClose} extraClass={styles.modal}>\n          <div className={styles.popup}>\n            <p className=\"text text_type_main mb-10\">Удалить коллекцию?</p>\n            {errorRemoveMessage && (\n              <span className={styles.error}>{errorRemoveMessage}</span>\n            )}\n            <div className={styles.popup_btn_box}>\n              <Button\n                type=\"button\"\n                extraClass={styles.popup_btn}\n                kind=\"support\"\n                text=\"Отмена\"\n                onClick={handlePopupClose}\n              />\n              <Button\n                type=\"button\"\n                extraClass={styles.popup_btn}\n                kind=\"secondary\"\n                onClick={handleRemoveCollection}\n                text=\"Удалить\"\n              />\n            </div>\n          </div>\n        </Modal>\n      )}\n    </section>\n  );\n};\n\nconst CollectionAddModal = ({\n  ownWishes,\n  onClose,\n  collectionsList,\n  setCollectionsList,\n}) => {\n  const [collectionData, setCollectionData] = useState({ wishes: {} });\n  const [valid, setValid] = useState(false);\n  const [errorMessage, setErrorMessage] = useState(\"\");\n\n  const formRef = useRef(null);\n\n  const submitCollection = (e) => {\n    e.preventDefault();\n    errorMessage && setErrorMessage(\"\");\n\n    const { name, image } = collectionData;\n    const itemsId = Object.entries(collectionData.wishes).map(([key, val]) => {\n      if (val) {\n        return +key;\n      }\n    });\n\n    addCollection({ name, image, itemsId })\n      .then((res) => {\n        const { name, image, id, owner } = res;\n        setCollectionsList([...collectionsList, { name, image, id, owner }]);\n        onClose();\n      })\n      .catch((err) => {\n        setErrorMessage(err.message);\n      });\n  };\n\n  const onFormChange = (e) => {\n    const isValid = formRef.current.checkValidity();\n    setValid(isValid);\n\n    const name = e.target.name;\n    const value = e.target.value;\n\n    if (name.startsWith(\"wish\")) {\n      const [, key] = name.split(\" \");\n      setCollectionData({\n        ...collectionData,\n        wishes: {\n          ...collectionData.wishes,\n          [key]: e.target.checked,\n        },\n      });\n    } else {\n      setCollectionData({\n        ...collectionData,\n        [name]: name === \"price\" ? parseInt(value) : value,\n      });\n    }\n  };\n\n  return (\n    <Modal\n      onClose={onClose}\n      extraClass={styles.collection_modal}\n      isCloseBtn={true}\n    >\n      <form\n        className={styles.collection_form}\n        onSubmit={submitCollection}\n        ref={formRef}\n      >\n        <h2 className=\"text text_type_h2 mb-16\">Добавить подарок</h2>\n        <Input\n          type=\"text\"\n          id={20}\n          extraClass=\"mb-12\"\n          label=\"Название коллекции\"\n          name=\"name\"\n          onChange={onFormChange}\n          placeholder=\"Укажите название коллекции\"\n          required\n        />\n        <Input\n          type=\"url\"\n          extraClass=\"mb-12\"\n          name=\"image\"\n          label=\"Ссылка на изображение\"\n          onChange={onFormChange}\n          placeholder=\"Укажите ссылку\"\n          required\n        />\n        <p\n          className={`text text_type_main text_color_black mb-4 ${styles.wishes_text}`}\n        >\n          Выберите товары из вашего вишлиста:\n        </p>\n        <div className={styles.wishes}>\n          {ownWishes.map((item) => {\n            return (\n              <div key={item.id} className=\"mb-4\">\n                <input\n                  className={styles.checkbox}\n                  type=\"checkbox\"\n                  id={item.id}\n                  name={`wish ${item.id}`}\n                  checked={collectionData.wishes[item.id] ?? false}\n                  onChange={onFormChange}\n                />\n                <label className={styles.checkbox} htmlFor={item.id}>\n                  {item.name}\n                </label>\n              </div>\n            );\n          })}\n        </div>\n        {errorMessage && <span className={styles.error}>{errorMessage}</span>}\n        <Button\n          type=\"submit\"\n          extraClass={styles.collection_btn}\n          text=\"Добавить коллекцию\"\n          kind=\"secondary\"\n          disabled={!valid}\n        />\n      </form>\n    </Modal>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}