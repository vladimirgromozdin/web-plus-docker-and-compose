{"ast":null,"code":"import _slicedToArray from\"/Users/vladimirgromozdin/Documents/dev/deploy-kupipodariday/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from\"react\";import{NavLink,useParams,useHistory}from\"react-router-dom\";import{Button,ButtonReturn,LoadingBox,Modal,Input}from\"../ui\";import{UserSupportedCard}from\"../user-supported-card\";import{priceArr}from\"../../utils/constants\";import{addOffer,getCard,copyWish,getOwnWishes}from\"../../utils/api\";import styles from\"./gift-page.module.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var GiftPage=function GiftPage(_ref){var _wishData$owner,_wishData$owner2,_wishData$offers,_wishData$offers2;var _ref$extraClass=_ref.extraClass,extraClass=_ref$extraClass===void 0?\"\":_ref$extraClass;var history=useHistory();var _useParams=useParams(),id=_useParams.id;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isPopupOpen=_useState2[0],setIsPopupOpen=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isAddToWishDisabled=_useState4[0],setIsAddToWishDisabled=_useState4[1];var _useState5=useState(100),_useState6=_slicedToArray(_useState5,2),currentSupportedBtn=_useState6[0],setCurrentSupportedBtn=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),anotherSum=_useState8[0],setAnotherSum=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),errorMessage=_useState10[0],setErrorMessage=_useState10[1];var _useState11=useState({}),_useState12=_slicedToArray(_useState11,2),wishData=_useState12[0],setWishData=_useState12[1];useEffect(function(){if(sessionStorage.getItem(\"auth_token\")){Promise.all([getCard(id),getOwnWishes()]).then(function(_ref2){var _ref3=_slicedToArray(_ref2,2),card=_ref3[0],wishlist=_ref3[1];setWishData(card);var goodInMyWish=wishlist.find(function(item){return item.id===card.id;});if(goodInMyWish){setIsAddToWishDisabled(true);}});}},[id]);var isRaised=wishData.raised===wishData.price;var handlePopupOpen=function handlePopupOpen(){setIsPopupOpen(true);};var handleSupportClick=function handleSupportClick(){errorMessage&&setErrorMessage(\"\");var amount=+anotherSum||currentSupportedBtn;addOffer({itemId:wishData.id,amount:amount,hidden:false}).then(function(){handlePopupClose();getCard(id).then(function(res){setWishData(res);});}).catch(function(err){setErrorMessage(err.message);});};var handleGoToShop=function handleGoToShop(){window.open(wishData.link,\"_blank\");};var handleCopyClick=function handleCopyClick(){copyWish(wishData.id).then(function(){return history.push(\"/wishlist\");});};var handlePopupClose=function handlePopupClose(){setIsPopupOpen(false);};var handleSupportedBtnsClick=function handleSupportedBtnsClick(e){var id=+e.target.closest(\"button\").getAttribute(\"id\");setCurrentSupportedBtn(id);setAnotherSum(\"\");};var handleChangeInput=function handleChangeInput(e){var sum=e.target.value;setAnotherSum(sum);setCurrentSupportedBtn(+sum);};return/*#__PURE__*/_jsxs(\"section\",{className:\"\".concat(styles.content,\" \").concat(extraClass),children:[/*#__PURE__*/_jsx(ButtonReturn,{}),/*#__PURE__*/_jsx(\"h1\",{className:\"text text_type_h1 mb-16\",children:wishData.name}),/*#__PURE__*/_jsxs(\"div\",{className:styles.data_box,children:[/*#__PURE__*/_jsx(\"img\",{className:styles.img,src:wishData.image,alt:\"\\u0424\\u043E\\u0442\\u043E \\u043F\\u043E\\u0434\\u0430\\u0440\\u043A\\u0430.\"}),/*#__PURE__*/_jsxs(\"div\",{className:styles.gift_data,children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text text_type_h1 mb-16\",children:\"\".concat(wishData.price,\" \\u0440\\u0443\\u0431.\")}),/*#__PURE__*/_jsxs(\"p\",{className:\"text text_type_main\",style:{maxWidth:\"75%\"},children:[\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u043B\\u0435\\u043D\\u043E \".concat(new Date(wishData.createdAt).toLocaleDateString(),\" \\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u0435\\u043C \"),/*#__PURE__*/_jsx(NavLink,{to:\"/users/\".concat(wishData===null||wishData===void 0?void 0:(_wishData$owner=wishData.owner)===null||_wishData$owner===void 0?void 0:_wishData$owner.username),className:\"text text_type_main text_color_primary \".concat(styles.link),children:\"\".concat(wishData===null||wishData===void 0?void 0:(_wishData$owner2=wishData.owner)===null||_wishData$owner2===void 0?void 0:_wishData$owner2.username,\" \",\"\\u2197\")})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text text_type_main\",style:{maxWidth:\"75%\"},children:\"\\u041E\\u043F\\u0438\\u0441\\u0430\\u043D\\u0438\\u0435: \".concat(wishData.description)}),/*#__PURE__*/_jsx(LoadingBox,{current:wishData.raised,total:wishData.price,extraClass:styles.load}),/*#__PURE__*/_jsxs(\"div\",{className:styles.btns_box,children:[/*#__PURE__*/_jsx(Button,{type:\"support\",kind:\"thirdly\",text:\"\\u041F\\u0435\\u0440\\u0435\\u0439\\u0442\\u0438 \\u0432 \\u043C\\u0430\\u0433\\u0430\\u0437\\u0438\\u043D\",extraClass:styles.btn,onClick:handleGoToShop}),/*#__PURE__*/_jsx(Button,{type:\"button\",kind:\"secondary\",text:\"\\u041F\\u043E\\u0434\\u0434\\u0435\\u0440\\u0436\\u0430\\u0442\\u044C\",extraClass:styles.btn,onClick:handlePopupOpen,disabled:isRaised}),/*#__PURE__*/_jsx(Button,{type:\"button\",kind:\"support\",text:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0432 \\u0432\\u0438\\u0448\\u043B\\u0438\\u0441\\u0442\",extraClass:styles.btn,onClick:handleCopyClick,disabled:isAddToWishDisabled})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:styles.supported_box,children:[/*#__PURE__*/_jsx(\"div\",{className:styles.subtitle_box,children:/*#__PURE__*/_jsx(\"h2\",{className:\"text text_ty-e_h2\",children:\"\\u0421\\u043F\\u0438\\u0441\\u043E\\u043A \\u043F\\u043E\\u0434\\u0434\\u0435\\u0440\\u0436\\u0430\\u0432\\u0448\\u0438\\u0445\"})}),wishData!==null&&wishData!==void 0&&(_wishData$offers=wishData.offers)!==null&&_wishData$offers!==void 0&&_wishData$offers.length?wishData===null||wishData===void 0?void 0:(_wishData$offers2=wishData.offers)===null||_wishData$offers2===void 0?void 0:_wishData$offers2.map(function(_ref4){var name=_ref4.name,amount=_ref4.amount,createdAt=_ref4.createdAt;return/*#__PURE__*/_jsx(UserSupportedCard,{name:name,amount:amount,date:createdAt});}):/*#__PURE__*/_jsx(\"p\",{children:\"\\u041F\\u043E\\u043A\\u0430 \\u043D\\u0438\\u043A\\u043E\\u0433\\u043E \\u043D\\u0435\\u0442\"})]}),isPopupOpen&&/*#__PURE__*/_jsx(Modal,{onClose:handlePopupClose,extraClass:styles.modal,isCloseBtn:true,children:/*#__PURE__*/_jsxs(\"div\",{className:styles.popup,children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text text_type_h2 mb-20\",children:\"\\u041F\\u043E\\u0434\\u0434\\u0435\\u0440\\u0436\\u0438\\u0442\\u0435 \\u043B\\u044E\\u0431\\u043E\\u0439 \\u0441\\u0443\\u043C\\u043C\\u043E\\u0439\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-20 \".concat(styles.gift_btns_box),children:[priceArr.map(function(item,index){return/*#__PURE__*/_jsx(Button,{id:item,type:\"button\",extraClass:styles.price_btn,text:\"\".concat(item,\" \\u0440\\u0443\\u0431\"),kind:currentSupportedBtn===item||currentSupportedBtn===anotherSum?\"primary\":\"support\",onClick:handleSupportedBtnsClick},index);}),/*#__PURE__*/_jsx(Input,{type:\"number\",extraInputClass:styles.price_input,placeholder:\"\\u0421\\u0443\\u043C\\u043C\\u0430\",value:anotherSum,onChange:handleChangeInput})]}),/*#__PURE__*/_jsx(Button,{type:\"button\",kind:\"secondary\",text:\"\\u041F\\u043E\\u0434\\u0434\\u0435\\u0440\\u0436\\u0430\\u0442\\u044C\",onClick:handleSupportClick,extraClass:styles.supported_btn}),errorMessage&&/*#__PURE__*/_jsx(\"span\",{className:styles.error,children:errorMessage})]})})]});};","map":{"version":3,"sources":["/Users/vladimirgromozdin/Documents/dev/deploy-kupipodariday/frontend/src/components/gift-page/gift-page.jsx"],"names":["useState","useEffect","NavLink","useParams","useHistory","Button","ButtonReturn","LoadingBox","Modal","Input","UserSupportedCard","priceArr","addOffer","getCard","copyWish","getOwnWishes","styles","GiftPage","extraClass","history","id","isPopupOpen","setIsPopupOpen","isAddToWishDisabled","setIsAddToWishDisabled","currentSupportedBtn","setCurrentSupportedBtn","anotherSum","setAnotherSum","errorMessage","setErrorMessage","wishData","setWishData","sessionStorage","getItem","Promise","all","then","card","wishlist","goodInMyWish","find","item","isRaised","raised","price","handlePopupOpen","handleSupportClick","amount","itemId","hidden","handlePopupClose","res","catch","err","message","handleGoToShop","window","open","link","handleCopyClick","push","handleSupportedBtnsClick","e","target","closest","getAttribute","handleChangeInput","sum","value","content","name","data_box","img","image","gift_data","maxWidth","Date","createdAt","toLocaleDateString","owner","username","description","load","btns_box","btn","supported_box","subtitle_box","offers","length","map","modal","popup","gift_btns_box","index","price_btn","price_input","supported_btn","error"],"mappings":"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","sourcesContent":["import { useState, useEffect } from \"react\";\nimport { NavLink, useParams, useHistory } from \"react-router-dom\";\n\nimport { Button, ButtonReturn, LoadingBox, Modal, Input } from \"../ui\";\nimport { UserSupportedCard } from \"../user-supported-card\";\n\nimport { priceArr } from \"../../utils/constants\";\n\nimport { addOffer, getCard, copyWish, getOwnWishes } from \"../../utils/api\";\n\nimport styles from \"./gift-page.module.css\";\n\nexport const GiftPage = ({ extraClass = \"\" }) => {\n  const history = useHistory();\n  const { id } = useParams();\n  const [isPopupOpen, setIsPopupOpen] = useState(false);\n  const [isAddToWishDisabled, setIsAddToWishDisabled] = useState(false);\n  const [currentSupportedBtn, setCurrentSupportedBtn] = useState(100);\n  const [anotherSum, setAnotherSum] = useState(\"\");\n  const [errorMessage, setErrorMessage] = useState(\"\");\n\n  const [wishData, setWishData] = useState({});\n  useEffect(() => {\n    if (sessionStorage.getItem(\"auth_token\")) {\n      Promise.all([getCard(id), getOwnWishes()]).then(([card, wishlist]) => {\n        setWishData(card);\n        const goodInMyWish = wishlist.find((item) => item.id === card.id);\n        if (goodInMyWish) {\n          setIsAddToWishDisabled(true);\n        }\n      });\n    }\n  }, [id]);\n\n  const isRaised = wishData.raised === wishData.price;\n\n  const handlePopupOpen = () => {\n    setIsPopupOpen(true);\n  };\n\n  const handleSupportClick = () => {\n    errorMessage && setErrorMessage(\"\");\n    const amount = +anotherSum || currentSupportedBtn;\n    addOffer({\n      itemId: wishData.id,\n      amount,\n      hidden: false,\n    })\n      .then(() => {\n        handlePopupClose();\n        getCard(id).then((res) => {\n          setWishData(res);\n        });\n      })\n      .catch((err) => {\n        setErrorMessage(err.message);\n      });\n  };\n\n  const handleGoToShop = () => {\n    window.open(wishData.link, \"_blank\");\n  };\n\n  const handleCopyClick = () => {\n    copyWish(wishData.id).then(() => history.push(\"/wishlist\"));\n  };\n\n  const handlePopupClose = () => {\n    setIsPopupOpen(false);\n  };\n\n  const handleSupportedBtnsClick = (e) => {\n    const id = +e.target.closest(\"button\").getAttribute(\"id\");\n    setCurrentSupportedBtn(id);\n    setAnotherSum(\"\");\n  };\n\n  const handleChangeInput = (e) => {\n    const sum = e.target.value;\n    setAnotherSum(sum);\n    setCurrentSupportedBtn(+sum);\n  };\n\n  return (\n    <section className={`${styles.content} ${extraClass}`}>\n      <ButtonReturn />\n      <h1 className=\"text text_type_h1 mb-16\">{wishData.name}</h1>\n      <div className={styles.data_box}>\n        <img className={styles.img} src={wishData.image} alt=\"Фото подарка.\" />\n        <div className={styles.gift_data}>\n          <h2 className=\"text text_type_h1 mb-16\">{`${wishData.price} руб.`}</h2>\n\n          <p className=\"text text_type_main\" style={{ maxWidth: \"75%\" }}>\n            {`Добавлено ${new Date(\n              wishData.createdAt\n            ).toLocaleDateString()} пользователем `}\n            <NavLink\n              to={`/users/${wishData?.owner?.username}`}\n              className={`text text_type_main text_color_primary ${styles.link}`}\n            >\n              {`${wishData?.owner?.username} ${\"\\u{2197}\"}`}\n            </NavLink>\n          </p>\n          <p\n            className=\"text text_type_main\"\n            style={{ maxWidth: \"75%\" }}\n          >{`Описание: ${wishData.description}`}</p>\n          <LoadingBox\n            current={wishData.raised}\n            total={wishData.price}\n            extraClass={styles.load}\n          />\n          <div className={styles.btns_box}>\n            <Button\n              type=\"support\"\n              kind=\"thirdly\"\n              text=\"Перейти в магазин\"\n              extraClass={styles.btn}\n              onClick={handleGoToShop}\n            />\n            <Button\n              type=\"button\"\n              kind=\"secondary\"\n              text=\"Поддержать\"\n              extraClass={styles.btn}\n              onClick={handlePopupOpen}\n              disabled={isRaised}\n            />\n            <Button\n              type=\"button\"\n              kind=\"support\"\n              text=\"Добавить в вишлист\"\n              extraClass={styles.btn}\n              onClick={handleCopyClick}\n              disabled={isAddToWishDisabled}\n            />\n          </div>\n        </div>\n      </div>\n      <div className={styles.supported_box}>\n        <div className={styles.subtitle_box}>\n          <h2 className=\"text text_ty-e_h2\">Список поддержавших</h2>\n        </div>\n        {wishData?.offers?.length ? (\n          wishData?.offers?.map(({ name, amount, createdAt }) => (\n            <UserSupportedCard name={name} amount={amount} date={createdAt} />\n          ))\n        ) : (\n          <p>Пока никого нет</p>\n        )}\n      </div>\n\n      {isPopupOpen && (\n        <Modal\n          onClose={handlePopupClose}\n          extraClass={styles.modal}\n          isCloseBtn={true}\n        >\n          <div className={styles.popup}>\n            <h2 className=\"text text_type_h2 mb-20\">Поддержите любой суммой</h2>\n            <div className={`mb-20 ${styles.gift_btns_box}`}>\n              {priceArr.map((item, index) => {\n                return (\n                  <Button\n                    key={index}\n                    id={item}\n                    type=\"button\"\n                    extraClass={styles.price_btn}\n                    text={`${item} руб`}\n                    kind={\n                      currentSupportedBtn === item ||\n                      currentSupportedBtn === anotherSum\n                        ? \"primary\"\n                        : \"support\"\n                    }\n                    onClick={handleSupportedBtnsClick}\n                  />\n                );\n              })}\n              <Input\n                type=\"number\"\n                extraInputClass={styles.price_input}\n                placeholder=\"Сумма\"\n                value={anotherSum}\n                onChange={handleChangeInput}\n              />\n            </div>\n            <Button\n              type=\"button\"\n              kind=\"secondary\"\n              text=\"Поддержать\"\n              onClick={handleSupportClick}\n              extraClass={styles.supported_btn}\n            />\n            {errorMessage && (\n              <span className={styles.error}>{errorMessage}</span>\n            )}\n          </div>\n        </Modal>\n      )}\n    </section>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}