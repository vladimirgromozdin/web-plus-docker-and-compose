{"ast":null,"code":"var _jsxFileName = \"/Users/vladimirgromozdin/Documents/dev/kupipodariday-frontend/src/components/main-page/collections-view.jsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport { useState, useEffect, useRef, useContext } from \"react\";\nimport { NavLink } from \"react-router-dom\";\nimport { Button, Input, Modal } from \"../ui\";\nimport trashIcon from \"../../images/icons/trash-red.svg\";\nimport { UserContext } from \"../../utils/context\";\nimport { addCollection, deleteCollection, getCollections } from \"../../utils/api\";\nimport styles from \"./main-page.module.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const CollectionsView = _ref => {\n  _s();\n\n  let {\n    url,\n    ownWishes\n  } = _ref;\n  const [isCollectionPopupOpen, setIsCollectionPopupOpen] = useState(false);\n  const [isRemovePopupOpen, setIsRemovePopupOpen] = useState(false);\n  const [idToRemove, setIdToRemove] = useState(\"\");\n  const [collectionsList, setCollectionsList] = useState([]);\n  const [errorRemoveMessage, setErrorRemoveMessage] = useState(\"\");\n  const [user] = useContext(UserContext);\n  useEffect(() => {\n    getCollections().then(res => setCollectionsList(res));\n  }, []);\n\n  const handleCollectionPopupOpen = () => {\n    setIsCollectionPopupOpen(true);\n  };\n\n  const handlePopupClose = () => {\n    isCollectionPopupOpen && setIsCollectionPopupOpen(false);\n    isRemovePopupOpen && setIsRemovePopupOpen(false);\n    errorRemoveMessage && setErrorRemoveMessage(\"\");\n  };\n\n  const handleRemoveClick = e => {\n    e.preventDefault();\n    setIdToRemove(e.target.closest(\"a\").name);\n    setIsRemovePopupOpen(true);\n  };\n\n  const handleRemoveCollection = () => {\n    deleteCollection(idToRemove).then(() => {\n      getCollections().then(res => {\n        setCollectionsList(res);\n        handlePopupClose();\n      });\n    }).catch(err => setErrorRemoveMessage(err.message));\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"section\", {\n    className: styles.collections,\n    children: [/*#__PURE__*/_jsxDEV(Button, {\n      kind: \"primary\",\n      text: \"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u043A\\u043E\\u043B\\u043B\\u0435\\u043A\\u0446\\u0438\\u044E\",\n      onClick: handleCollectionPopupOpen\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: styles.cards_box,\n      children: collectionsList.map(card => {\n        var _card$owner;\n\n        return /*#__PURE__*/_jsxDEV(NavLink, {\n          className: styles.card,\n          name: card.id,\n          to: `${url}/collections/${card.id}`,\n          style: {\n            backgroundImage: `url(${card.image})`\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            className: `text text_type_cardh3 text_color_secondary ${styles.text}`,\n            children: card.name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 77,\n            columnNumber: 15\n          }, this), user.id === ((_card$owner = card.owner) === null || _card$owner === void 0 ? void 0 : _card$owner.id) && /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            className: styles.remove_btn,\n            onClick: handleRemoveClick,\n            children: /*#__PURE__*/_jsxDEV(\"img\", {\n              src: trashIcon,\n              alt: \"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 88,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 83,\n            columnNumber: 17\n          }, this)]\n        }, card.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 68,\n          columnNumber: 13\n        }, this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 7\n    }, this), isCollectionPopupOpen && /*#__PURE__*/_jsxDEV(CollectionAddModal, {\n      ownWishes: ownWishes,\n      onClose: handlePopupClose,\n      collectionsList: collectionsList,\n      setCollectionsList: setCollectionsList\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 9\n    }, this), isRemovePopupOpen && /*#__PURE__*/_jsxDEV(Modal, {\n      onClose: handlePopupClose,\n      extraClass: styles.modal,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: styles.popup,\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text text_type_main mb-10\",\n          children: \"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C \\u043A\\u043E\\u043B\\u043B\\u0435\\u043A\\u0446\\u0438\\u044E?\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 106,\n          columnNumber: 13\n        }, this), errorRemoveMessage && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: styles.error,\n          children: errorRemoveMessage\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: styles.popup_btn_box,\n          children: [/*#__PURE__*/_jsxDEV(Button, {\n            type: \"button\",\n            extraClass: styles.popup_btn,\n            kind: \"support\",\n            text: \"\\u041E\\u0442\\u043C\\u0435\\u043D\\u0430\",\n            onClick: handlePopupClose\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 111,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            type: \"button\",\n            extraClass: styles.popup_btn,\n            kind: \"secondary\",\n            onClick: handleRemoveCollection,\n            text: \"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 118,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 110,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 59,\n    columnNumber: 5\n  }, this);\n};\n\n_s(CollectionsView, \"YgKMOol9tPOK975uUEfUX88DXvw=\");\n\n_c = CollectionsView;\n\nconst CollectionAddModal = _ref2 => {\n  _s2();\n\n  let {\n    ownWishes,\n    onClose,\n    collectionsList,\n    setCollectionsList\n  } = _ref2;\n  const [collectionData, setCollectionData] = useState({\n    wishes: {}\n  });\n  const [valid, setValid] = useState(false);\n  const [errorMessage, setErrorMessage] = useState(\"\");\n  const formRef = useRef(null);\n\n  const submitCollection = e => {\n    e.preventDefault();\n    errorMessage && setErrorMessage(\"\");\n    const {\n      name,\n      image\n    } = collectionData;\n    const itemsId = Object.entries(collectionData.wishes).map(_ref3 => {\n      let [key, val] = _ref3;\n\n      if (val) {\n        return +key;\n      }\n    });\n    addCollection({\n      name,\n      image,\n      itemsId\n    }).then(res => {\n      const {\n        name,\n        image,\n        id,\n        owner\n      } = res;\n      setCollectionsList([...collectionsList, {\n        name,\n        image,\n        id,\n        owner\n      }]);\n      onClose();\n    }).catch(err => {\n      setErrorMessage(err.message);\n    });\n  };\n\n  const onFormChange = e => {\n    const isValid = formRef.current.checkValidity();\n    setValid(isValid);\n    const name = e.target.name;\n    const value = e.target.value;\n\n    if (name.startsWith(\"wish\")) {\n      const [, key] = name.split(\" \");\n      setCollectionData({ ...collectionData,\n        wishes: { ...collectionData.wishes,\n          [key]: e.target.checked\n        }\n      });\n    } else {\n      setCollectionData({ ...collectionData,\n        [name]: name === \"price\" ? parseInt(value) : value\n      });\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(Modal, {\n    onClose: onClose,\n    extraClass: styles.collection_modal,\n    isCloseBtn: true,\n    children: /*#__PURE__*/_jsxDEV(\"form\", {\n      className: styles.collection_form,\n      onSubmit: submitCollection,\n      ref: formRef,\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"text text_type_h2 mb-16\",\n        children: \"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u043F\\u043E\\u0434\\u0430\\u0440\\u043E\\u043A\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Input, {\n        type: \"text\",\n        id: 20,\n        extraClass: \"mb-12\",\n        label: \"\\u041D\\u0430\\u0437\\u0432\\u0430\\u043D\\u0438\\u0435 \\u043A\\u043E\\u043B\\u043B\\u0435\\u043A\\u0446\\u0438\\u0438\",\n        name: \"name\",\n        onChange: onFormChange,\n        placeholder: \"\\u0423\\u043A\\u0430\\u0436\\u0438\\u0442\\u0435 \\u043D\\u0430\\u0437\\u0432\\u0430\\u043D\\u0438\\u0435 \\u043A\\u043E\\u043B\\u043B\\u0435\\u043A\\u0446\\u0438\\u0438\",\n        required: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Input, {\n        type: \"url\",\n        extraClass: \"mb-12\",\n        name: \"image\",\n        label: \"\\u0421\\u0441\\u044B\\u043B\\u043A\\u0430 \\u043D\\u0430 \\u0438\\u0437\\u043E\\u0431\\u0440\\u0430\\u0436\\u0435\\u043D\\u0438\\u0435\",\n        onChange: onFormChange,\n        placeholder: \"\\u0423\\u043A\\u0430\\u0436\\u0438\\u0442\\u0435 \\u0441\\u0441\\u044B\\u043B\\u043A\\u0443\",\n        required: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: `text text_type_main text_color_black mb-4 ${styles.wishes_text}`,\n        children: \"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u0442\\u043E\\u0432\\u0430\\u0440\\u044B \\u0438\\u0437 \\u0432\\u0430\\u0448\\u0435\\u0433\\u043E \\u0432\\u0438\\u0448\\u043B\\u0438\\u0441\\u0442\\u0430:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 222,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: styles.wishes,\n        children: ownWishes.map(item => {\n          var _collectionData$wishe;\n\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mb-4\",\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              className: styles.checkbox,\n              type: \"checkbox\",\n              id: item.id,\n              name: `wish ${item.id}`,\n              checked: (_collectionData$wishe = collectionData.wishes[item.id]) !== null && _collectionData$wishe !== void 0 ? _collectionData$wishe : false,\n              onChange: onFormChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 231,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n              className: styles.checkbox,\n              htmlFor: item.id,\n              children: item.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 239,\n              columnNumber: 17\n            }, this)]\n          }, item.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 230,\n            columnNumber: 15\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 9\n      }, this), errorMessage && /*#__PURE__*/_jsxDEV(\"span\", {\n        className: styles.error,\n        children: errorMessage\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 26\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        type: \"submit\",\n        extraClass: styles.collection_btn,\n        text: \"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u043A\\u043E\\u043B\\u043B\\u0435\\u043A\\u0446\\u0438\\u044E\",\n        kind: \"secondary\",\n        disabled: !valid\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 247,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 192,\n    columnNumber: 5\n  }, this);\n};\n\n_s2(CollectionAddModal, \"/aOQxiScIgm8VHW4h7CNQtXAV6U=\");\n\n_c2 = CollectionAddModal;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"CollectionsView\");\n$RefreshReg$(_c2, \"CollectionAddModal\");","map":{"version":3,"sources":["/Users/vladimirgromozdin/Documents/dev/kupipodariday-frontend/src/components/main-page/collections-view.jsx"],"names":["useState","useEffect","useRef","useContext","NavLink","Button","Input","Modal","trashIcon","UserContext","addCollection","deleteCollection","getCollections","styles","CollectionsView","url","ownWishes","isCollectionPopupOpen","setIsCollectionPopupOpen","isRemovePopupOpen","setIsRemovePopupOpen","idToRemove","setIdToRemove","collectionsList","setCollectionsList","errorRemoveMessage","setErrorRemoveMessage","user","then","res","handleCollectionPopupOpen","handlePopupClose","handleRemoveClick","e","preventDefault","target","closest","name","handleRemoveCollection","catch","err","message","collections","cards_box","map","card","id","backgroundImage","image","text","owner","remove_btn","modal","popup","error","popup_btn_box","popup_btn","CollectionAddModal","onClose","collectionData","setCollectionData","wishes","valid","setValid","errorMessage","setErrorMessage","formRef","submitCollection","itemsId","Object","entries","key","val","onFormChange","isValid","current","checkValidity","value","startsWith","split","checked","parseInt","collection_modal","collection_form","wishes_text","item","checkbox","collection_btn"],"mappings":"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","sourcesContent":["import { useState, useEffect, useRef, useContext } from \"react\";\nimport { NavLink } from \"react-router-dom\";\n\nimport { Button, Input, Modal } from \"../ui\";\n\nimport trashIcon from \"../../images/icons/trash-red.svg\";\n\nimport { UserContext } from \"../../utils/context\";\n\nimport {\n  addCollection,\n  deleteCollection,\n  getCollections,\n} from \"../../utils/api\";\n\nimport styles from \"./main-page.module.css\";\n\nexport const CollectionsView = ({ url, ownWishes }) => {\n  const [isCollectionPopupOpen, setIsCollectionPopupOpen] = useState(false);\n  const [isRemovePopupOpen, setIsRemovePopupOpen] = useState(false);\n  const [idToRemove, setIdToRemove] = useState(\"\");\n  const [collectionsList, setCollectionsList] = useState([]);\n  const [errorRemoveMessage, setErrorRemoveMessage] = useState(\"\");\n\n  const [user] = useContext(UserContext);\n\n  useEffect(() => {\n    getCollections().then((res) => setCollectionsList(res));\n  }, []);\n\n  const handleCollectionPopupOpen = () => {\n    setIsCollectionPopupOpen(true);\n  };\n\n  const handlePopupClose = () => {\n    isCollectionPopupOpen && setIsCollectionPopupOpen(false);\n    isRemovePopupOpen && setIsRemovePopupOpen(false);\n    errorRemoveMessage && setErrorRemoveMessage(\"\");\n  };\n\n  const handleRemoveClick = (e) => {\n    e.preventDefault();\n    setIdToRemove(e.target.closest(\"a\").name);\n    setIsRemovePopupOpen(true);\n  };\n\n  const handleRemoveCollection = () => {\n    deleteCollection(idToRemove)\n      .then(() => {\n        getCollections().then((res) => {\n          setCollectionsList(res);\n          handlePopupClose();\n        });\n      })\n      .catch((err) => setErrorRemoveMessage(err.message));\n  };\n\n  return (\n    <section className={styles.collections}>\n      <Button\n        kind=\"primary\"\n        text=\"Добавить коллекцию\"\n        onClick={handleCollectionPopupOpen}\n      />\n      <div className={styles.cards_box}>\n        {collectionsList.map((card) => {\n          return (\n            <NavLink\n              key={card.id}\n              className={styles.card}\n              name={card.id}\n              to={`${url}/collections/${card.id}`}\n              style={{\n                backgroundImage: `url(${card.image})`,\n              }}\n            >\n              <h3\n                className={`text text_type_cardh3 text_color_secondary ${styles.text}`}\n              >\n                {card.name}\n              </h3>\n              {user.id === card.owner?.id && (\n                <button\n                  type=\"button\"\n                  className={styles.remove_btn}\n                  onClick={handleRemoveClick}\n                >\n                  <img src={trashIcon} alt=\"Удалить.\" />\n                </button>\n              )}\n            </NavLink>\n          );\n        })}\n      </div>\n      {isCollectionPopupOpen && (\n        <CollectionAddModal\n          ownWishes={ownWishes}\n          onClose={handlePopupClose}\n          collectionsList={collectionsList}\n          setCollectionsList={setCollectionsList}\n        />\n      )}\n      {isRemovePopupOpen && (\n        <Modal onClose={handlePopupClose} extraClass={styles.modal}>\n          <div className={styles.popup}>\n            <p className=\"text text_type_main mb-10\">Удалить коллекцию?</p>\n            {errorRemoveMessage && (\n              <span className={styles.error}>{errorRemoveMessage}</span>\n            )}\n            <div className={styles.popup_btn_box}>\n              <Button\n                type=\"button\"\n                extraClass={styles.popup_btn}\n                kind=\"support\"\n                text=\"Отмена\"\n                onClick={handlePopupClose}\n              />\n              <Button\n                type=\"button\"\n                extraClass={styles.popup_btn}\n                kind=\"secondary\"\n                onClick={handleRemoveCollection}\n                text=\"Удалить\"\n              />\n            </div>\n          </div>\n        </Modal>\n      )}\n    </section>\n  );\n};\n\nconst CollectionAddModal = ({\n  ownWishes,\n  onClose,\n  collectionsList,\n  setCollectionsList,\n}) => {\n  const [collectionData, setCollectionData] = useState({ wishes: {} });\n  const [valid, setValid] = useState(false);\n  const [errorMessage, setErrorMessage] = useState(\"\");\n\n  const formRef = useRef(null);\n\n  const submitCollection = (e) => {\n    e.preventDefault();\n    errorMessage && setErrorMessage(\"\");\n\n    const { name, image } = collectionData;\n    const itemsId = Object.entries(collectionData.wishes).map(([key, val]) => {\n      if (val) {\n        return +key;\n      }\n    });\n\n    addCollection({ name, image, itemsId })\n      .then((res) => {\n        const { name, image, id, owner } = res;\n        setCollectionsList([...collectionsList, { name, image, id, owner }]);\n        onClose();\n      })\n      .catch((err) => {\n        setErrorMessage(err.message);\n      });\n  };\n\n  const onFormChange = (e) => {\n    const isValid = formRef.current.checkValidity();\n    setValid(isValid);\n\n    const name = e.target.name;\n    const value = e.target.value;\n\n    if (name.startsWith(\"wish\")) {\n      const [, key] = name.split(\" \");\n      setCollectionData({\n        ...collectionData,\n        wishes: {\n          ...collectionData.wishes,\n          [key]: e.target.checked,\n        },\n      });\n    } else {\n      setCollectionData({\n        ...collectionData,\n        [name]: name === \"price\" ? parseInt(value) : value,\n      });\n    }\n  };\n\n  return (\n    <Modal\n      onClose={onClose}\n      extraClass={styles.collection_modal}\n      isCloseBtn={true}\n    >\n      <form\n        className={styles.collection_form}\n        onSubmit={submitCollection}\n        ref={formRef}\n      >\n        <h2 className=\"text text_type_h2 mb-16\">Добавить подарок</h2>\n        <Input\n          type=\"text\"\n          id={20}\n          extraClass=\"mb-12\"\n          label=\"Название коллекции\"\n          name=\"name\"\n          onChange={onFormChange}\n          placeholder=\"Укажите название коллекции\"\n          required\n        />\n        <Input\n          type=\"url\"\n          extraClass=\"mb-12\"\n          name=\"image\"\n          label=\"Ссылка на изображение\"\n          onChange={onFormChange}\n          placeholder=\"Укажите ссылку\"\n          required\n        />\n        <p\n          className={`text text_type_main text_color_black mb-4 ${styles.wishes_text}`}\n        >\n          Выберите товары из вашего вишлиста:\n        </p>\n        <div className={styles.wishes}>\n          {ownWishes.map((item) => {\n            return (\n              <div key={item.id} className=\"mb-4\">\n                <input\n                  className={styles.checkbox}\n                  type=\"checkbox\"\n                  id={item.id}\n                  name={`wish ${item.id}`}\n                  checked={collectionData.wishes[item.id] ?? false}\n                  onChange={onFormChange}\n                />\n                <label className={styles.checkbox} htmlFor={item.id}>\n                  {item.name}\n                </label>\n              </div>\n            );\n          })}\n        </div>\n        {errorMessage && <span className={styles.error}>{errorMessage}</span>}\n        <Button\n          type=\"submit\"\n          extraClass={styles.collection_btn}\n          text=\"Добавить коллекцию\"\n          kind=\"secondary\"\n          disabled={!valid}\n        />\n      </form>\n    </Modal>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}